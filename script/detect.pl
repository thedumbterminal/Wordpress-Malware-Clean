#!/usr/bin/env perl
use strict;
use warnings;
use Carp;
use Data::Dumper;
use lib qw(lib ../lib);
use Wordpress::Malware::Clean;
if($#ARGV == 0){
	my $cleaner = Wordpress::Malware::Clean->new($ARGV[0]);
	my $sig = $cleaner->getSignature();
	if($sig){
		print "Found signature:\n" . $sig . "\n";
		print "Looks ok? (y/n): ";
		my $answer = <STDIN>;
		chomp $answer;
		if($answer eq "y"){
			$cleaner->doProcess();
		}
		else{
			die("Aborted\n");
		}
	}
	else{
		die("No malware signature found\n");
	}
	print "Clean files saved to: " . $cleaner->getClean()->dirname() . "\n";
	print "...done\n";
}
else{
	die("Usage: $0 <infected dir>\n");
}